<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Halid`s Ping Pong</title>
	<style type="text/css">
		body {
			margin: 0;
		}
		canvas {
			display: block;

			user-select: none;
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
    <canvas id="gc" width="800" height="600"></canvas>
    <script type="text/javascript">
    const PADDLE_WIDTH = 10;
    const PADDLE_HEIGHT = 100;
    const BALL_WIDTH = 10;
    const WIN_SCORE = 10;
    var won = false;
    var c,cc,p1y,p2y,bx,by;
    var p1s=p2s=0;
    var vx = 10;
    var vy = 4;

    window.onload = function() {
        c = document.getElementById('gc');
        cc = c.getContext('2d');
        window.addEventListener('resize', resize);
        resize();
        p1y=p2y=c.height/2 - PADDLE_HEIGHT/2;
        c.addEventListener('mousedown', function(){
        	if (won) {
        		p1s = 0;
        		p2s = 0;
        		won = false;
        	}
        });
        document.addEventListener('mousemove',
            function(evt) {
                var rect = c.getBoundingClientRect();
                var root = document.documentElement;
                //var mouseX = evt.clientX - rect.left - root.scrollLeft;
                var mouseY = evt.clientY - rect.top - root.scrollTop;
                p1y = mouseY - (PADDLE_HEIGHT / 2);
            });
        c.addEventListener('touchmove',
            function(evt) {
                p1y = evt.touches[0].clientY - (PADDLE_HEIGHT / 2);
        });

        setInterval(function() {
            movement();
            update();
        }, 1000/30);
    }
    function resize() {
        ballReset();
    	c.width = window.innerWidth;
        c.height = window.innerHeight;
    }
    function drawNet() {
    	for (var i = 0; i < c.height; i +=40) {
    		rect(c.width/2-1,i,2, 20, 'white');
    	}
    }
    function movement() {
    	if(won) 
    		return;
        bx += vx;
        by += vy;
        AI();
        if (bx > c.width - PADDLE_WIDTH - BALL_WIDTH) {
            if (by > p2y - 5 && by < p2y + PADDLE_HEIGHT + 5) {
                vx = -vx;
                var dx = by - (p2y + PADDLE_HEIGHT / 2);
                vy = dx * 0.35;
            } else {
                p1s++;
                resize();
            }
        } else if (bx < PADDLE_WIDTH + BALL_WIDTH) {
            if (by > p1y-5 && by < p1y + PADDLE_HEIGHT+5) {
                vx = -vx;
                var dx = by - (p1y + PADDLE_HEIGHT / 2);
                vy = dx * 0.35;
            } else {
                p2s++;
                resize();
            }
        }
        if (by > c.height - BALL_WIDTH)
            vy = -vy;
        else if (by < BALL_WIDTH)
            vy = -vy;
    }

    function update() {
        rect(0, 0, c.width, c.height, "black");
        cc.fillStyle = 'white';
        if (won) {
        	cc.font = "bold 20px Comic Sans MS";
        	if (p1s >= WIN_SCORE) {
        		cc.fillText("Right player has won.", c.width/2-115, c.height/2-150);
        	} else {
        		cc.fillText("Left player has won.", c.width/2-115, c.height/2-150);
        	}
        	cc.fillText("Click to continue.", c.width/2-100, c.height-150);
        	return;
        }
        cc.font = "bold 18px Comic Sans MS";
        cc.fillText(p1s, 100, 100);
        cc.fillText(p2s, c.width - 100, 100);
        drawNet();
        circle(bx, by, BALL_WIDTH, "white");
        rect(0, p1y, PADDLE_WIDTH, PADDLE_HEIGHT, "white");
        rect(c.width - PADDLE_WIDTH, p2y, PADDLE_WIDTH, PADDLE_HEIGHT, "white");
    }

    function AI() {
        var amount = 6;
        var pYC = p2y + (PADDLE_HEIGHT / 2);
        if (pYC < by - 35)
            p2y += amount;
        else if (pYC > by + 35)
            p2y -= amount;
    }

    function ballReset() {
        if (p1s >= WIN_SCORE || p2s >= WIN_SCORE)
            won = true;
        vx = -vx;
        bx = c.width / 2;
        by = c.height / 2;
    }

    function circle(centerX, centerY, radius, color) {
        cc.fillStyle = color;
        cc.beginPath();
        cc.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
        cc.fill();
    }

    function rect(x, y, width, height, color) {
        cc.fillStyle = color;
        cc.fillRect(x, y, width, height);
    }
    </script>
</body>

</html>
